<!-- index.html -->

<!DOCTYPE html>
<html>
<head>
    <title>hello world</title>
</head>
<body>
    
    <h1> Hello Quantum Penguin! </h1>
    <form id="user-form">
        <label for="draft">User Input: </label>
        <br>
        <textarea id="draft" name="draft" rows="5" cols="50"></textarea>
        <br>
        <button type="submit">Generate</button>
    </form>

    <div id="output">
        <!-- The generated output will be displayed here -->
    </div>

    <button class="hints">Start listening</button>
    <div>
      <p class="output"><em>Result output: (...diagnostic messages)</em></p>
    </div>

    <script>
        const form = document.getElementById('user-form');
        const outputDiv = document.getElementById('output');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const inputText = form.draft.value;

            const response = await fetch('/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    input_text: inputText
                })
            });

            const data = await response.json();
            outputDiv.innerHTML = `<h3>Generated Output:</h3><p>${data.output_text}</p>`;
        });

        //  ========= Speech recognition ================
        // From: https://github.com/mdn/dom-examples/blob/main/web-speech-api/speech-color-changer/script.js
        var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition
        var SpeechGrammarList = SpeechGrammarList || window.webkitSpeechGrammarList
        var SpeechRecognitionEvent = SpeechRecognitionEvent || webkitSpeechRecognitionEvent

        var recognition = new SpeechRecognition();
        if (SpeechGrammarList) {
        // SpeechGrammarList is not currently available in Safari, and does not have any effect in any other browser.
        // This code is provided as a demonstration of possible capability. You may choose not to use it.
            var speechRecognitionList = new SpeechGrammarList();
            var grammar = '#JSGF V1.0; grammar colors; public <color> = ' + colors.join(' | ') + ' ;'
            speechRecognitionList.addFromString(grammar, 1);
            recognition.grammars = speechRecognitionList;
        }
        recognition.continuous = false;
        recognition.lang = 'en-US';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        var diagnostic = document.querySelector('.output');
        var bg = document.querySelector('html');
        var hints = document.querySelector('.hints');


        document.body.onclick = function() {
            recognition.start();
            console.log('Ready to receive a color command.');
        }

        recognition.onresult = function(event) {
            // The SpeechRecognitionEvent results property returns a SpeechRecognitionResultList object
            // The SpeechRecognitionResultList object contains SpeechRecognitionResult objects.
            // It has a getter so it can be accessed like an array
            // The first [0] returns the SpeechRecognitionResult at the last position.
            // Each SpeechRecognitionResult object contains SpeechRecognitionAlternative objects that contain individual results.
            // These also have getters so they can be accessed like arrays.
            // The second [0] returns the SpeechRecognitionAlternative at position 0.
            // We then return the transcript property of the SpeechRecognitionAlternative object
            var result = event.results[0][0].transcript;
            diagnostic.textContent = 'Result received: ' + result + '.';
            // bg.style.backgroundColor = color;
            // console.log('Confidence: ' + event.results[0][0].confidence);
        }

        recognition.onspeechend = function() {
            recognition.stop();
        }

        // recognition.onnomatch = function(event) {
        // diagnostic.textContent = "I didn't recognise that color.";
        // }

        recognition.onerror = function(event) {
            diagnostic.textContent = 'Error occurred in recognition: ' + event.error;
        }
    </script>
</body>
</html>